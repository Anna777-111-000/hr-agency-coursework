{% extends 'base.html' %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
        <a href="{% url 'admin:create_user' %}" class="btn btn-success btn-lg">
            ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        </a>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–∞—Ö -->
    {% if messages %}
    <div class="mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–æ–ª—è–º -->
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card text-white bg-dark">
                <div class="card-body text-center">
                    <h2>{{ users|length }}</h2>
                    <p>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-danger">
                <div class="card-body text-center">
                    <h2>{{ admins_count }}</h2>
                    <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body text-center">
                    <h2>{{ managers_count }}</h2>
                    <p>–ú–µ–Ω–µ–¥–∂–µ—Ä–æ–≤</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-body text-center">
                    <h2>{{ recruiters_count }}</h2>
                    <p>–†–µ–∫—Ä—É—Ç–µ—Ä–æ–≤</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="card mt-4">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
            <span class="badge bg-light text-dark">{{ users|length }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
        </div>
        <div class="card-body">
            {% if users %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>–õ–æ–≥–∏–Ω</th>
                            <th>–ò–º—è</th>
                            <th>Email</th>
                            <th>–†–æ–ª—å</th>
                            <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user_obj in users %}
                        <tr>
                            <td>
                                <strong>{{ user_obj.username }}</strong>
                                {% if user_obj.username == 'systemadmin' %}
                                <span class="badge bg-danger ms-1">–°–∏—Å—Ç–µ–º–Ω—ã–π</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if user_obj.first_name or user_obj.last_name %}
                                    {{ user_obj.first_name }} {{ user_obj.last_name }}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if user_obj.email %}
                                    {{ user_obj.email }}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge
                                    {% if user_obj.role == 'administrator' %}bg-danger
                                    {% elif user_obj.role == 'manager' %}bg-warning text-dark
                                    {% else %}bg-info{% endif %}">
                                    {% if user_obj.role == 'administrator' %}–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                                    {% elif user_obj.role == 'manager' %}–ú–µ–Ω–µ–¥–∂–µ—Ä
                                    {% elif user_obj.role == 'recruiter' %}–†–µ–∫—Ä—É—Ç–µ—Ä
                                    {% else %}{{ user_obj.role }}{% endif %}
                                </span>
                            </td>
                            <td>{{ user_obj.date_joined|date:"d.m.Y H:i" }}</td>
                            <td>
                                {% if user_obj.is_active %}
                                <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                {% else %}
                                <span class="badge bg-secondary">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                                {% endif %}
                            </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{% url 'admin:edit_user' user_obj.id %}" class="btn btn-outline-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                            ‚úèÔ∏è
                                        </a>
                                        <a href="{% url 'admin:delete_user' user_obj.id %}" class="btn btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">
                                            üóëÔ∏è
                                        </a>
                                    </div>
                                </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <div class="text-muted mb-3">
                    <h4>üòî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π</p>
                </div>
                <a href="{% url 'admin:create_user' %}" class="btn btn-success btn-lg">
                    ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- JavaScript –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<script>
function confirmDelete(userId, username) {
    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "${username}"?`)) {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
        alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)`);
    }
}

function editUser(userId) {
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    alert(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: ${userId} (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)`);
}
</script>

<style>
.table th {
    border-top: none;
    font-weight: 600;
}
.badge {
    font-size: 0.75em;
}
.card {
    border: none;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}
.card-header {
    border-bottom: 1px solid rgba(0,0,0,.125);
    font-weight: 600;
}
</style>
{% endblock %}