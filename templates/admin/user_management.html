{% extends 'base.html' %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>

    <!-- –ë–ª–æ–∫ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ -->
    {% if user.username == 'systemadmin' %}
    <div class="card mt-4">
        <div class="card-header bg-warning text-dark">
            <h5>üîê –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h5>
        </div>
        <div class="card-body">
            <form method="post" action="">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-4">
                        <input type="password" name="current_password" class="form-control" placeholder="–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    <div class="col-md-4">
                        <input type="password" name="new_password" class="form-control" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-warning">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="card mt-4">
        <div class="card-header bg-primary text-white">
            <h5>‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">–õ–æ–≥–∏–Ω</label>
                        <input type="text" name="username" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" name="password" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Email</label>
                        <input type="email" name="email" class="form-control" placeholder="email@example.com">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">–†–æ–ª—å</label>
                        <select name="role" class="form-control" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                            <option value="recruiter">–†–µ–∫—Ä—É—Ç–µ—Ä</option>
                            <option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        </select>
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button type="submit" class="btn btn-success w-100">–°–æ–∑–¥–∞—Ç—å</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–∞—Ö -->
    {% if messages %}
    <div class="mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="card mt-4">
        <div class="card-header bg-secondary text-white">
            <h5>üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã</h5>
        </div>
        <div class="card-body">
            {% if users %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>–õ–æ–≥–∏–Ω</th>
                            <th>–ò–º—è</th>
                            <th>Email</th>
                            <th>–†–æ–ª—å</th>
                            <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user_obj in users %}
                        <tr>
                            <td>
                                <strong>{{ user_obj.username }}</strong>
                                {% if user_obj.is_system_user %}
                                <span class="badge bg-danger ms-1">–°–∏—Å—Ç–µ–º–Ω—ã–π</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if user_obj.first_name or user_obj.last_name %}
                                    {{ user_obj.first_name }} {{ user_obj.last_name }}
                                {% else %}
                                    <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if user_obj.email %}
                                    {{ user_obj.email }}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge
                                    {% if user_obj.role == 'admin' %}bg-danger
                                    {% elif user_obj.role == 'manager' %}bg-warning text-dark
                                    {% else %}bg-info{% endif %}">
                                    {{ user_obj.get_role_display }}
                                </span>
                            </td>
                            <td>{{ user_obj.date_joined|date:"d.m.Y H:i" }}</td>
                            <td>
                                {% if user_obj.is_active %}
                                <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                {% else %}
                                <span class="badge bg-secondary">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <p class="text-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–æ–ª—è–º -->
    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card text-white bg-danger">
                <div class="card-body text-center">
                    <h3>{{ users|length }}</h3>
                    <p>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-warning">
                <div class="card-body text-center">
                    <h3>{{ users|selectattr:"role"|select_equal:"admin"|length }}</h3>
                    <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success">
                <div class="card-body text-center">
                    <h3>{{ users|selectattr:"role"|select_equal:"manager"|length }}</h3>
                    <p>–ú–µ–Ω–µ–¥–∂–µ—Ä–æ–≤</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
    <div class="card mt-4">
        <div class="card-header bg-light">
            <h6>üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <h6>–†–µ–∫—Ä—É—Ç–µ—Ä</h6>
                    <ul class="small">
                        <li>–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</li>
                        <li>–ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</li>
                        <li>–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è</li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h6>–ú–µ–Ω–µ–¥–∂–µ—Ä</h6>
                    <ul class="small">
                        <li>–í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞</li>
                        <li>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</li>
                        <li>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏—è–º–∏</li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h6>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h6>
                    <ul class="small">
                        <li>–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º</li>
                        <li>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</li>
                        <li>–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.table th {
    border-top: none;
    font-weight: 600;
}
.badge {
    font-size: 0.75em;
}
.card {
    border: none;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}
.card-header {
    border-bottom: 1px solid rgba(0,0,0,.125);
    font-weight: 600;
}
</style>
{% endblock %}