{% extends 'base.html' %}

{% block title %}{{ candidate.first_name }} {{ candidate.last_name }} - HR Agency{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
    <div class="mb-3">
        <a href="{% url 'candidate_list' %}" class="btn btn-outline-secondary">
            ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
        </a>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    {% if messages %}
    <div class="messages mb-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="row">
        <div class="col-md-8">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">üë§ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                    {% if candidate.position_level %}
                    <span class="badge bg-light text-dark fs-6">
                        {{ candidate.get_position_level_display }}
                    </span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>–§–ò–û:</strong> {{ candidate.last_name }} {{ candidate.first_name }} {{ candidate.patronymic }}</p>
                            <p><strong>Email:</strong> {{ candidate.email }}</p>
                            {% if candidate.phone %}
                            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ candidate.phone }}</p>
                            {% endif %}
                            {% if candidate.age %}
                            <p><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> {{ candidate.age }} –ª–µ—Ç</p>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            {% if candidate.experience_years %}
                            <p><strong>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã:</strong> {{ candidate.experience_years }} –ª–µ—Ç</p>
                            {% endif %}
                            {% if candidate.specialization %}
                            <p><strong>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</strong> {{ candidate.specialization }}</p>
                            {% endif %}
                            {% if candidate.employment_status %}
                            <p><strong>–°—Ç–∞—Ç—É—Å —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> {{ candidate.get_employment_status_display }}</p>
                            {% endif %}
                            {% if candidate.work_format %}
                            <p><strong>–§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã:</strong> {{ candidate.get_work_format_display }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            {% if candidate.last_workplace or candidate.last_position or candidate.responsibilities %}
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">üíº –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                </div>
                <div class="card-body">
                    {% if candidate.last_workplace %}
                    <p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã:</strong> {{ candidate.last_workplace }}</p>
                    {% endif %}
                    {% if candidate.last_position %}
                    <p><strong>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</strong> {{ candidate.last_position }}</p>
                    {% endif %}
                    {% if candidate.work_period %}
                    <p><strong>–ü–µ—Ä–∏–æ–¥ —Ä–∞–±–æ—Ç—ã:</strong> {{ candidate.work_period }}</p>
                    {% endif %}
                    {% if candidate.responsibilities %}
                    <div class="mt-3">
                        <strong>–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:</strong>
                        <div class="mt-2 p-3 bg-light rounded">
                            {{ candidate.responsibilities|linebreaks }}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ -->
            {% if candidate.education_level %}
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> {{ candidate.get_education_level_display }}</p>
                            {% if candidate.education_institution %}
                            <p><strong>–£—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ:</strong> {{ candidate.education_institution }}</p>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            {% if candidate.education_specialty %}
                            <p><strong>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</strong> {{ candidate.education_specialty }}</p>
                            {% endif %}
                            {% if candidate.graduation_year %}
                            <p><strong>–ì–æ–¥ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</strong> {{ candidate.graduation_year }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –ü—Ä–∏–º–µ—á–∞–Ω–∏—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ -->
            {% if candidate.recruiter_notes or candidate.next_actions or candidate.candidate_features %}
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞</h5>
                </div>
                <div class="card-body">
                    {% if candidate.recruiter_notes %}
                    <div class="mb-3">
                        <strong>–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</strong>
                        <div class="mt-1 p-2 bg-white border rounded">
                            {{ candidate.recruiter_notes|linebreaks }}
                        </div>
                    </div>
                    {% endif %}

                    {% if candidate.next_actions %}
                    <div class="mb-3">
                        <strong>–ü–ª–∞–Ω —Å–ª–µ–¥—É—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π:</strong>
                        <div class="mt-1 p-2 bg-white border rounded">
                            {{ candidate.next_actions|linebreaks }}
                        </div>
                    </div>
                    {% endif %}

                    {% if candidate.candidate_features %}
                    <div class="mb-3">
                        <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:</strong>
                        <div class="mt-1 p-2 bg-white border rounded">
                            {{ candidate.candidate_features|linebreaks }}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <div class="col-md-4">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">üìã –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                </div>
                <div class="card-body">
                    {% if candidate.desired_salary %}
                    <div class="mb-3">
                        <strong>–ñ–µ–ª–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞:</strong>
                        <div class="fw-bold text-success fs-5">{{ candidate.desired_salary }} —Ä—É–±.</div>
                    </div>
                    {% endif %}

                    {% if candidate.notice_period %}
                    <div class="mb-3">
                        <strong>–°—Ä–æ–∫ –≤—ã—Ö–æ–¥–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É:</strong>
                        <div>{{ candidate.notice_period }}</div>
                    </div>
                    {% endif %}

                    <div class="mb-3">
                        <strong>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:</strong>
                        <div>{{ candidate.created_at|date:"d.m.Y H:i" }}</div>
                    </div>

                    <div class="mb-3">
                        <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong>
                        <div>{{ candidate.updated_at|date:"d.m.Y H:i" }}</div>
                    </div>
                </div>
            </div>

            <!-- –ù–∞–≤—ã–∫–∏ -->
            {% if candidate.skills.all %}
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">üõ†Ô∏è –ù–∞–≤—ã–∫–∏</h6>
                </div>
                <div class="card-body">
                    {% for skill in candidate.skills.all %}
                    <span class="badge bg-primary mb-2 me-1 fs-6">{{ skill.name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–æ–≤ -->
            {% if user.role == 'recruiter' or user.role == 'manager' or user.role == 'admin' %}
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">üîç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–æ–≤</h6>
                </div>
                <div class="card-body">
                    {% if candidate.source %}
                    <div class="mb-2">
                        <strong>–ò—Å—Ç–æ—á–Ω–∏–∫:</strong>
                        <span class="badge bg-secondary">{{ candidate.get_source_display }}</span>
                    </div>
                    {% endif %}

                    {% if candidate.source_details %}
                    <div class="mb-2">
                        <strong>–î–µ—Ç–∞–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:</strong>
                        <div class="small">{{ candidate.source_details }}</div>
                    </div>
                    {% endif %}

                    {% if candidate.assigned_recruiter %}
                    <div class="mb-2">
                        <strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–∫—Ä—É—Ç–µ—Ä:</strong>
                        <div>{{ candidate.assigned_recruiter }}</div>
                    </div>
                    {% endif %}

                    {% if candidate.resume %}
                    <div class="mt-3">
                        <strong>–†–µ–∑—é–º–µ:</strong>
                        <div>
                            {% if candidate.resume.url %}
                                <a href="{{ candidate.resume.url }}" class="btn btn-outline-primary btn-sm mt-1" target="_blank">
                                    üìé –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—é–º–µ
                                </a>
                                <br>
                                <a href="{% url 'download_resume' candidate.id %}" class="btn btn-outline-success btn-sm mt-1">
                                    ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—é–º–µ
                                </a>
                            {% else %}
                                <a href="{% url 'download_resume' candidate.id %}" class="btn btn-outline-primary btn-sm mt-1">
                                    üìé –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—é–º–µ
                                </a>
                            {% endif %}
                            <small class="d-block text-muted mt-1">
                                –§–∞–π–ª: {{ candidate.resume.name }}
                            </small>
                        </div>
                    </div>
                    {% else %}
                    <div class="mt-3">
                        <strong>–†–µ–∑—é–º–µ:</strong>
                        <div class="text-muted">
                            <small>–†–µ–∑—é–º–µ –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ</small>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- –î–µ–π—Å—Ç–≤–∏—è -->
            {% if user.role == 'recruiter' or user.role == 'manager' or user.role == 'admin' %}
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">‚ö° –î–µ–π—Å—Ç–≤–∏—è</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="#" class="btn btn-outline-success">
                            üìã –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –∫ –≤–∞–∫–∞–Ω—Å–∏–∏
                        </a>
                        <a href="#" class="btn btn-outline-info">
                            üìû –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ
                        </a>
                        {% if candidate.resume %}
                            {% if candidate.resume.url %}
                            <a href="{{ candidate.resume.url }}" class="btn btn-outline-warning" target="_blank">
                                üìÑ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—é–º–µ
                            </a>
                            {% endif %}
                            <a href="{% url 'download_resume' candidate.id %}" class="btn btn-outline-primary">
                                ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—é–º–µ
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.card {
    border: 1px solid #e9ecef;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    transition: transform 0.2s;
}
.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}
.card-header {
    border-bottom: 1px solid #e9ecef;
    font-weight: 600;
}
.badge {
    font-size: 0.75em;
    font-weight: 500;
}
.btn {
    border-radius: 0.375rem;
    font-weight: 500;
}
.alert {
    border-radius: 0.5rem;
}
</style>

<script>
// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
document.addEventListener('DOMContentLoaded', function() {
    const actionButtons = document.querySelectorAll('.btn-outline-success, .btn-outline-info');
    actionButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            if (!this.href || this.href === '#') {
                e.preventDefault();
                const action = this.textContent.trim();
                alert(`–§—É–Ω–∫—Ü–∏—è "${action}" –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`);
            }
        });
    });
});
</script>
{% endblock %}