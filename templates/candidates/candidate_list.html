{% extends 'base.html' %}

{% block title %}–ö–∞–Ω–¥–∏–¥–∞—Ç—ã - HR Agency{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1>–ö–∞–Ω–¥–∏–¥–∞—Ç—ã</h1>
            <p class="lead">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</p>
        </div>
        {% if user.role == 'recruiter' or user.role == 'manager' %}
        <a href="{% url 'candidate_create' %}" class="btn btn-success">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
        </a>
        {% endif %}
    </div>

    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-6">
                    <label for="search" class="form-label">–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ñ–∞–º–∏–ª–∏–∏ –∏–ª–∏ email:</label>
                    <input type="text" class="form-control" id="search" name="search"
                           value="{{ search_query }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å...">
                </div>
                <div class="col-md-4">
                    <label for="min_experience" class="form-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–ø—ã—Ç (–ª–µ—Ç):</label>
                    <input type="number" class="form-control" id="min_experience" name="min_experience"
                           value="{{ min_experience }}" min="0" placeholder="0">
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">–ù–∞–π—Ç–∏</button>
                </div>
            </form>
            {% if search_query or min_experience %}
            <div class="mt-3">
                <a href="{% url 'candidate_list' %}" class="btn btn-outline-secondary btn-sm">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">{{ candidates.count }}</h5>
                    <p class="card-text">–í—Å–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</p>
                </div>
            </div>
        </div>
        {% if user.role == 'manager' or user.role == 'administrator' %}
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">{{ candidates.filter.is_approved|length }}</h5>
                    <p class="card-text">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –æ—Ç–¥–µ–ª–æ–º –∫–∞–¥—Ä–æ–≤</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div class="row">
        {% for candidate in candidates %}
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        <a href="{% url 'candidate_detail' candidate.id %}" class="text-decoration-none text-dark">
                            {{ candidate.last_name }} {{ candidate.first_name }} {{ candidate.patronymic }}
                        </a>
                    </h5>
                    <p class="card-text">
                        <strong>üìß Email:</strong> {{ candidate.email }}<br>
                        <strong>üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ candidate.phone|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}<br>
                        {% if candidate.work_experience_total %}
                        <strong>üíº –û–ø—ã—Ç:</strong> {{ candidate.work_experience_total }} –ª–µ—Ç<br>
                        {% endif %}
                        {% if candidate.age %}
                        <strong>üéÇ –í–æ–∑—Ä–∞—Å—Ç:</strong> {{ candidate.age }} –ª–µ—Ç<br>
                        {% endif %}
                        <strong>üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</strong> {{ candidate.get_education_display }}<br>
                        <strong>üìö –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</strong> {{ candidate.specialty }}
                    </p>

                    <!-- –°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏ –∞–¥–º–∏–Ω–æ–≤) -->
                    {% if user.role == 'manager' or user.role == 'administrator' %}
                    <div class="mt-2">
                        <span class="badge {% if candidate.is_approved %}bg-success{% else %}bg-warning{% endif %}">
                            {% if candidate.is_approved %}‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ{% else %}‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ{% endif %}
                        </span>
                    </div>
                    {% endif %}
                </div>
                <div class="card-footer">
                    <small class="text-muted">
                        üìÖ –î–æ–±–∞–≤–ª–µ–Ω: {{ candidate.created_at|date:"d.m.Y" }}
                    </small>
                    <div class="float-end">
                        <a href="{% url 'candidate_detail' candidate.id %}" class="btn btn-outline-primary btn-sm">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Ä∫
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info text-center">
                {% if search_query or min_experience %}
                <h5>üîç –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞ –∏–ª–∏ <a href="{% url 'candidate_create' %}">–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</a></p>
                {% else %}
                <h5>üìù –ü–æ–∫–∞ –Ω–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</h5>
                <p>–ù–∞—á–Ω–∏—Ç–µ —Å <a href="{% url 'candidate_create' %}">–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</a> –≤ –±–∞–∑—É</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ) -->
    {% if candidates.has_other_pages %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            {% if candidates.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ candidates.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if min_experience %}&min_experience={{ min_experience }}{% endif %}">–ù–∞–∑–∞–¥</a>
            </li>
            {% endif %}

            {% for num in candidates.paginator.page_range %}
            <li class="page-item {% if candidates.number == num %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if min_experience %}&min_experience={{ min_experience }}{% endif %}">{{ num }}</a>
            </li>
            {% endfor %}

            {% if candidates.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ candidates.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if min_experience %}&min_experience={{ min_experience }}{% endif %}">–í–ø–µ—Ä–µ–¥</a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}