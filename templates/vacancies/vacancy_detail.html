<!-- templates/vacancies/vacancy_detail.html -->
{% extends 'base.html' %}

{% block title %}{{ vacancy.title }} - HR Agency{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
    <div class="mb-3">
        <a href="{% url 'vacancy_list' %}" class="btn btn-outline-secondary">
            ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –≤–∞–∫–∞–Ω—Å–∏–π
        </a>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    {% if messages %}
    <div class="messages mb-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="row">
        <div class="col-md-8">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">{{ vacancy.title }}</h4>
                    <div>
                        <span class="badge {% if vacancy.status == 'open' %}bg-success{% elif vacancy.status == 'closed' %}bg-danger{% else %}bg-secondary{% endif %} me-1">
                            {{ vacancy.get_status_display }}
                        </span>
                        <span class="badge bg-info">{{ vacancy.get_work_format_display }}</span>
                    </div>
                </div>
                <div class="card-body">
                    <h5>–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h5>
                    <div class="mb-4 p-3 bg-light rounded">
                        {{ vacancy.description|linebreaks }}
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>–¢—Ä–µ–±—É–µ–º—ã–π –æ–ø—ã—Ç:</strong> {{ vacancy.required_experience }} –ª–µ—Ç</p>
                            <p><strong>–¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏:</strong> {{ vacancy.get_employment_type_display }}</p>
                        </div>
                        <div class="col-md-6">
                            {% if vacancy.salary %}
                            <p><strong>–ó–∞—Ä–ø–ª–∞—Ç–∞:</strong> <span class="text-success fw-bold">{{ vacancy.salary }} —Ä—É–±.</span></p>
                            {% endif %}
                            {% if vacancy.location %}
                            <p><strong>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</strong> {{ vacancy.location }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¢—Ä–µ–±—É–µ–º—ã–µ –Ω–∞–≤—ã–∫–∏ -->
            {% if vacancy.required_skills.all %}
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">üõ†Ô∏è –¢—Ä–µ–±—É–µ–º—ã–µ –Ω–∞–≤—ã–∫–∏</h5>
                </div>
                <div class="card-body">
                    {% for skill in vacancy.required_skills.all %}
                    <span class="badge bg-primary mb-2 me-1 fs-6">{{ skill.name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <div class="col-md-4">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞–∫–∞–Ω—Å–∏–∏ -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞–∫–∞–Ω—Å–∏–∏</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>–°–æ–∑–¥–∞—Ç–µ–ª—å:</strong>
                        <div>{{ vacancy.created_by.username }}</div>
                    </div>

                    {% if vacancy.assigned_recruiter %}
                    <div class="mb-3">
                        <strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–∫—Ä—É—Ç–µ—Ä:</strong>
                        <div>{{ vacancy.assigned_recruiter.username }}</div>
                    </div>
                    {% else %}
                    <div class="mb-3">
                        <strong>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–∫—Ä—É—Ç–µ—Ä:</strong>
                        <div class="text-muted">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</div>
                    </div>
                    {% endif %}

                    <div class="mb-3">
                        <strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong>
                        <div>{{ vacancy.created_at|date:"d.m.Y H:i" }}</div>
                    </div>

                    <div class="mb-3">
                        <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong>
                        <div>{{ vacancy.updated_at|date:"d.m.Y H:i" }}</div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∫–ª–∏–∫–æ–≤ –∏ —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">üë• –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong>–í—Å–µ–≥–æ –æ—Ç–∫–ª–∏–∫–æ–≤:</strong>
                        <span class="badge bg-primary float-end">{{ applications_count }}</span>
                    </div>
                    <div class="mb-3">
                        <strong>–û–¥–æ–±—Ä–µ–Ω–æ:</strong>
                        <span class="badge bg-success float-end">{{ approved_applications }}</span>
                    </div>

                    {% if applications_count > 0 %}
                    <div class="progress mt-2" style="height: 10px;">
                        <div class="progress-bar bg-success"
                             style="width: {% widthratio approved_applications applications_count 100 %}%">
                        </div>
                    </div>
                    <small class="text-muted">
                        {% widthratio approved_applications applications_count 100 %}% –æ–¥–æ–±—Ä–µ–Ω–æ
                    </small>

                    <!-- –°–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ -->
                    <div class="mt-4">
                        <strong>–°–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:</strong>
                        <div class="mt-2">
                            {% for application in applications %}
                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                                <div>
                                    <a href="{% url 'candidate_detail' application.candidate.id %}" class="text-decoration-none">
                                        <strong>{{ application.candidate.last_name }} {{ application.candidate.first_name }}</strong>
                                    </a>
                                    <br>
                                    <small class="text-muted">
                                        {{ application.candidate.specialization|default:"–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞" }}
                                        {% if application.candidate.experience_years %}
                                        ‚Ä¢ –û–ø—ã—Ç: {{ application.candidate.experience_years }} –ª–µ—Ç
                                        {% endif %}
                                    </small>
                                </div>
                                <div>
                                    <span class="badge {% if application.status == 'approved' %}bg-success{% elif application.status == 'rejected' %}bg-danger{% else %}bg-warning{% endif %}">
                                        {{ application.get_status_display }}
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center text-muted py-3">
                        <i class="fas fa-users fa-2x mb-2"></i>
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞/–∞–¥–º–∏–Ω–∞ -->
            {% if user.role == 'manager' or user.role == 'admin' %}
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">‚ö° –î–µ–π—Å—Ç–≤–∏—è</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'vacancy_edit' vacancy.id %}" class="btn btn-outline-warning">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </a>

                        {% if vacancy.status == 'open' %}
                        <a href="{% url 'vacancy_change_status' vacancy.id 'closed' %}" class="btn btn-outline-danger"
                           onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é ¬´{{ vacancy.title }}¬ª?')">
                            üîí –ó–∞–∫—Ä—ã—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                        </a>
                        {% elif vacancy.status == 'closed' %}
                        <a href="{% url 'vacancy_change_status' vacancy.id 'open' %}" class="btn btn-outline-success"
                           onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é ¬´{{ vacancy.title }}¬ª?')">
                            üîì –û—Ç–∫—Ä—ã—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                        </a>
                        {% elif vacancy.status == 'draft' %}
                        <a href="{% url 'vacancy_change_status' vacancy.id 'open' %}" class="btn btn-outline-success"
                           onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é ¬´{{ vacancy.title }}¬ª?')">
                            üì¢ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                        </a>
                        {% endif %}

                        <a href="{% url 'vacancy_delete' vacancy.id %}" class="btn btn-outline-danger"
                           onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é ¬´{{ vacancy.title }}¬ª? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ -->
            {% if user.role == 'recruiter' and vacancy.assigned_recruiter == user %}
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">üë• –î–µ–π—Å—Ç–≤–∏—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'candidate_list' %}" class="btn btn-outline-primary">
                            ‚ûï –ù–∞–π—Ç–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
                        </a>
                        <a href="{% url 'candidate_list' %}" class="btn btn-outline-info">
                            üìÖ –°–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
                        </a>
                        {% if applications_count > 0 %}
                        <button type="button" class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#candidateStatisticsModal">
                            üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–æ–≤ -->
            {% if user.role == 'recruiter' %}
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞</h6>
                </div>
                <div class="card-body">
                    <small class="text-muted">
                        {% if vacancy.assigned_recruiter %}
                            {% if vacancy.assigned_recruiter == user %}
                                <strong class="text-success">‚úì –í—ã –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º</strong> –∑–∞ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é
                                <br>
                                <span class="text-muted">–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö —Å—Ç–∞—Ç—É—Å–∞–º–∏</span>
                            {% else %}
                                –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: <strong>{{ vacancy.assigned_recruiter.username }}</strong>
                                <br>
                                <span class="text-muted">–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç–µ –∏—Ö —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</span>
                            {% endif %}
                        {% else %}
                            <strong class="text-warning">‚ö†Ô∏è –†–µ–∫—Ä—É—Ç–µ—Ä –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</strong>
                            <br>
                            <span class="text-muted">–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ</span>
                        {% endif %}
                    </small>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è –¥–ª—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–∞ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π -->
    {% if user.role == 'recruiter' and applications_count > 0 %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">üìà –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 text-center">
                            <div class="border rounded p-3">
                                <h3 class="text-primary">{{ applications_count }}</h3>
                                <p class="mb-0">–í—Å–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</p>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="border rounded p-3">
                                <h3 class="text-success">{{ approved_applications }}</h3>
                                <p class="mb-0">–û–¥–æ–±—Ä–µ–Ω–æ</p>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="border rounded p-3">
                                <h3 class="text-warning">{{ applications_count|add:"-approved_applications" }}</h3>
                                <p class="mb-0">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</p>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="border rounded p-3">
                                {% if applications_count > 0 %}
                                <h3 class="text-info">{% widthratio approved_applications applications_count 100 %}%</h3>
                                {% else %}
                                <h3 class="text-info">0%</h3>
                                {% endif %}
                                <p class="mb-0">–ü—Ä–æ—Ü–µ–Ω—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è</p>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ -->
                    <div class="mt-4">
                        <h6>–ü–æ–¥—Ä–æ–±–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:</h6>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>–§–ò–û</th>
                                        <th>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</th>
                                        <th>–û–ø—ã—Ç</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–∞—Ç–∞ –æ—Ç–∫–ª–∏–∫–∞</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for application in applications %}
                                    <tr>
                                        <td>
                                            <a href="{% url 'candidate_detail' application.candidate.id %}" class="text-decoration-none">
                                                <strong>{{ application.candidate.last_name }} {{ application.candidate.first_name }}</strong>
                                            </a>
                                        </td>
                                        <td>{{ application.candidate.specialization|default:"‚Äî" }}</td>
                                        <td>
                                            {% if application.candidate.experience_years %}
                                            {{ application.candidate.experience_years }} –ª–µ—Ç
                                            {% else %}
                                            ‚Äî
                                            {% endif %}
                                        </td>
                                        <td>
                                            <span class="badge {% if application.status == 'approved' %}bg-success{% elif application.status == 'rejected' %}bg-danger{% else %}bg-warning{% endif %}">
                                                {{ application.get_status_display }}
                                            </span>
                                        </td>
                                        <td>{{ application.applied_date|date:"d.m.Y" }}</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <a href="{% url 'candidate_detail' application.candidate.id %}" class="btn btn-outline-primary">
                                                    –ü—Ä–æ—Ñ–∏–ª—å
                                                </a>
                                                {% if vacancy.assigned_recruiter == user %}
                                                <button type="button" class="btn btn-outline-success" onclick="changeApplicationStatus({{ application.id }}, 'approved')">
                                                    ‚úÖ
                                                </button>
                                                <button type="button" class="btn btn-outline-danger" onclick="changeApplicationStatus({{ application.id }}, 'rejected')">
                                                    ‚ùå
                                                </button>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
<div class="modal fade" id="candidateStatisticsModal" tabindex="-1" aria-labelledby="candidateStatisticsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="candidateStatisticsModalLabel">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row text-center">
                    <div class="col-md-4 mb-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <h3>{{ applications_count }}</h3>
                                <p class="mb-0">–í—Å–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <h3>{{ approved_applications }}</h3>
                                <p class="mb-0">–û–¥–æ–±—Ä–µ–Ω–æ</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-info text-white">
                            <div class="card-body">
                                <h3>
                                    {% if applications_count > 0 %}
                                    {% widthratio approved_applications applications_count 100 %}%
                                    {% else %}
                                    0%
                                    {% endif %}
                                </h3>
                                <p class="mb-0">–ü—Ä–æ—Ü–µ–Ω—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-3">
                    <h6>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º:</h6>
                    <div class="progress" style="height: 30px;">
                        {% if applications_count > 0 %}
                        <div class="progress-bar bg-success" style="width: {% widthratio approved_applications applications_count 100 %}%">
                            –û–¥–æ–±—Ä–µ–Ω–æ ({{ approved_applications }})
                        </div>
                        <div class="progress-bar bg-warning" style="width: {% widthratio pending_applications applications_count 100 %}%">
                            –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ ({{ pending_applications }})
                        </div>
                        <div class="progress-bar bg-danger" style="width: {% widthratio rejected_applications applications_count 100 %}%">
                            –û—Ç–∫–ª–æ–Ω–µ–Ω–æ ({{ rejected_applications }})
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border: 1px solid #e9ecef;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    transition: transform 0.2s;
}
.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}
.card-header {
    border-bottom: 1px solid #e9ecef;
    font-weight: 600;
}
.badge {
    font-size: 0.75em;
    font-weight: 500;
}
.progress {
    border-radius: 5px;
}
.btn {
    border-radius: 0.375rem;
    font-weight: 500;
    transition: all 0.2s;
}
.btn:hover {
    transform: translateY(-1px);
}
.alert {
    border-radius: 0.5rem;
}
.table th {
    border-top: none;
    font-weight: 600;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 5000);
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏ (–∑–∞–≥–ª—É—à–∫–∞)
function changeApplicationStatus(applicationId, newStatus) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏?')) {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        alert('–§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function updateStatistics() {
    const pendingApplications = {{ applications_count }} - {{ approved_applications }};
    const rejectedApplications = 0; // –ü–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

    document.querySelector('.progress-bar.bg-warning').style.width =
        (pendingApplications / {{ applications_count }} * 100) + '%';
    document.querySelector('.progress-bar.bg-warning').textContent =
        '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ (' + pendingApplications + ')';

    document.querySelector('.progress-bar.bg-danger').style.width =
        (rejectedApplications / {{ applications_count }} * 100) + '%';
    document.querySelector('.progress-bar.bg-danger').textContent =
        '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ (' + rejectedApplications + ')';
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
updateStatistics();
</script>
{% endblock %}